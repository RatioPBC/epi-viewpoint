#! /usr/bin/env bash

source "bin/_support/check.sh"

set +e
check "Docker running" "docker info  > /dev/null 2>&1" "sudo dockerd # or maybe: docker-machine start default && eval \$(docker-machine env)"
set -e

if [ -n "$GITLAB_CI" ]; then # CI variable is present in gitlab only
  COMMIT_SHA=$CI_COMMIT_SHA
else
  COMMIT_SHA=$(git rev-parse --verify HEAD)
fi

docker build . -t epicenter:latest --build-arg HEX_GEOMETER_READ_ONLY_KEY="${HEX_GEOMETER_READ_ONLY_KEY}" --build-arg COMMIT_SHA=$COMMIT_SHA
